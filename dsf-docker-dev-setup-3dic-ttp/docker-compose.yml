#
# Copyright 2018-2025 Heilbronn University of Applied Sciences
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

version: '3.8'
services:
  proxy:
    image: nginx:1.29
    restart: "no"
    ports:
      - 127.0.0.1:443:443
    secrets:
      - localhost.chain.crt
      - localhost.key.plain
      - issuing_ca.crt
      - ca_chain.crt
    volumes:
      - type: bind
        source: ./proxy/conf.d
        target: /etc/nginx/conf.d
        read_only: true
      - type: bind
        source: ./proxy/nginx.conf
        target: /etc/nginx/nginx.conf
        read_only: true
    networks:
      dic1-fhir-frontend:
        ipv4_address: 172.20.0.2
      dic2-fhir-frontend:
        ipv4_address: 172.20.0.10
      dic3-fhir-frontend:
        ipv4_address: 172.20.0.18
      ttp-fhir-frontend:
        ipv4_address: 172.20.0.26
      dic1-bpe-frontend:
        ipv4_address: 172.20.0.34
      dic2-bpe-frontend:
        ipv4_address: 172.20.0.42
      dic3-bpe-frontend:
        ipv4_address: 172.20.0.50
      ttp-bpe-frontend:
        ipv4_address: 172.20.0.58
      internet:
        aliases:
          - dic1
          - dic2
          - dic3
          - ttp
    environment:
      TZ: Europe/Berlin

  db:
    image: postgres:18
    restart: "no"
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U liquibase_user -d postgres" ]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      TZ: Europe/Berlin
      POSTGRES_PASSWORD_FILE: /run/secrets/db_liquibase.password
      POSTGRES_USER: liquibase_user
      POSTGRES_DB: postgres
    networks:
      - dic1-fhir-backend
      - dic2-fhir-backend
      - dic3-fhir-backend
      - ttp-fhir-backend
      - dic1-bpe-backend
      - dic2-bpe-backend
      - dic3-bpe-backend
      - ttp-bpe-backend
    secrets:
      - db_liquibase.password
    volumes:
      - type: volume
        source: postgresql
        target: /var/lib/postgresql
      - type: bind
        source: ./db/init-db.sh
        target: /docker-entrypoint-initdb.d/init-db.sh
        read_only: true

  keycloak:
    image: quay.io/keycloak/keycloak:26.3
    restart: "no"
    ports:
      - 127.0.0.1:8443:8443
    environment:
      TZ: Europe/Berlin
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
    secrets:
      - keycloak.chain.crt
      - keycloak.key.plain
      - keycloak_trust_store.jks
    volumes:
      - type: bind
        source: ./keycloak
        target: /opt/keycloak/data/import
    networks:
      - internet
    command: >-
      start
      --db dev-file
      --hostname keycloak
      --import-realm
      --https-certificate-file=/run/secrets/keycloak.chain.crt
      --https-certificate-key-file=/run/secrets/keycloak.key.plain
      --spi-truststore-file-file=/run/secrets/keycloak_trust_store.jks
      --spi-truststore-file-password=password

  forward-proxy:
    build: ./forward-proxy
    restart: "no"
    environment:
      TZ: Europe/Berlin
    networks:
      forward-proxy:
      internet:

  dic1-fhir:
    build: ../dsf-fhir/dsf-fhir-server-jetty/docker
    image: datasharingframework/fhir
    restart: "no"
    ports:
     - 127.0.0.1:5001:5001
    secrets:
      - db_liquibase.password
      - db_dic1_fhir_user.password
      - db_dic1_fhir_user_permanent_delete.password
      - root_ca.crt
      - dic1.crt
      - dic1.key
      - ca_chain.crt
      - oidc_client_dic1_fhir.secret
    volumes:
      - type: bind
        source: ./dic1/fhir/log
        target: /opt/fhir/log
      - type: bind
        source: ./dic1/ui/logo.svg
        target: /opt/fhir/ui/logo.svg
        read_only: true
      - type: bind
        source: ./dic1/ui/logo_dark.svg
        target: /opt/fhir/ui/logo_dark.svg
        read_only: true
      - type: bind
        source: ./ui/fhir_mod.css
        target: /opt/fhir/ui/mod.css
        read_only: true
    environment:
      TZ: Europe/Berlin
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5001
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic1_fhir
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_dic1_fhir_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_dic1_fhir_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/dic1.crt
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/dic1.key
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD: 'password'
      DEV_DSF_FHIR_SERVER_UI_THEME: dev
      DEV_DSF_FHIR_DB_USER_GROUP: dic1_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic1_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic1_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic1_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic1/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_1
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE: [Task]
              - READ
              - UPDATE: [QuestionnaireResponse]
              - SEARCH
              - HISTORY
            practitioner-role:
              - http://dsf.dev/fhir/CodeSystem/practitioner-role|DSF_ADMIN
        - bpe-oidc-auth-client:
            token-role: default-roles-dic1
            dsf-role:
              - READ
              - SEARCH
              - HISTORY
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/ca_chain.crt
      DEV_DSF_SERVER_AUTH_OIDC_AUTHORIZATION_CODE_FLOW: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BACK_CHANNEL_LOGOUT: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN_AUDIENCE: 'account'
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_REALM_BASE_URL: https://keycloak:8443/realms/dic1
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_ID: dic1-fhir
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_SECRET_FILE: /run/secrets/oidc_client_dic1_fhir.secret
    networks:
      dic1-fhir-frontend:
        ipv4_address: 172.20.0.3
      dic1-fhir-backend:
      internet:
    depends_on:
      - db
      - proxy
      - keycloak

  dic2-fhir:
    build: ../dsf-fhir/dsf-fhir-server-jetty/docker
    image: datasharingframework/fhir
    restart: "no"
    ports:
     - 127.0.0.1:5002:5002
    secrets:
      - db_liquibase.password
      - db_dic2_fhir_user.password
      - db_dic2_fhir_user_permanent_delete.password
      - root_ca.crt
      - dic2.crt
      - dic2.key
      - ca_chain.crt
      - oidc_client_dic2_fhir.secret
    volumes:
      - type: bind
        source: ./dic2/fhir/log
        target: /opt/fhir/log
      - type: bind
        source: ./dic2/ui/logo.svg
        target: /opt/fhir/ui/logo.svg
        read_only: true
      - type: bind
        source: ./dic2/ui/logo_dark.svg
        target: /opt/fhir/ui/logo_dark.svg
        read_only: true
      - type: bind
        source: ./ui/fhir_mod.css
        target: /opt/fhir/ui/mod.css
        read_only: true
    environment:
      TZ: Europe/Berlin
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5002
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic2_fhir
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_dic2_fhir_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_dic2_fhir_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/dic2.crt
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/dic2.key
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD: 'password'
      DEV_DSF_FHIR_SERVER_UI_THEME: dev
      DEV_DSF_FHIR_DB_USER_GROUP: dic2_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic2_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic2_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic2_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic2/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_2
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE:
                - Task
              - READ
              - UPDATE:
                - QuestionnaireResponse
              - SEARCH
              - HISTORY
            practitioner-role:
              - http://dsf.dev/fhir/CodeSystem/practitioner-role|DSF_ADMIN
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/ca_chain.crt
      DEV_DSF_SERVER_AUTH_OIDC_AUTHORIZATION_CODE_FLOW: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BACK_CHANNEL_LOGOUT: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_REALM_BASE_URL: https://keycloak:8443/realms/dic2
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_ID: dic2-fhir
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_SECRET_FILE: /run/secrets/oidc_client_dic2_fhir.secret
    networks:
      dic2-fhir-frontend:
        ipv4_address: 172.20.0.11
      dic2-fhir-backend:
      internet:
    depends_on:
      - db
      - proxy
      - keycloak

  dic3-fhir:
    build: ../dsf-fhir/dsf-fhir-server-jetty/docker
    image: datasharingframework/fhir
    restart: "no"
    ports:
     - 127.0.0.1:5003:5003
    secrets:
      - db_liquibase.password
      - db_dic3_fhir_user.password
      - db_dic3_fhir_user_permanent_delete.password
      - root_ca.crt
      - dic3.crt
      - dic3.key
      - ca_chain.crt
      - oidc_client_dic3_fhir.secret
    volumes:
      - type: bind
        source: ./dic3/fhir/log
        target: /opt/fhir/log
      - type: bind
        source: ./dic3/ui/logo.svg
        target: /opt/fhir/ui/logo.svg
        read_only: true
      - type: bind
        source: ./dic3/ui/logo_dark.svg
        target: /opt/fhir/ui/logo_dark.svg
        read_only: true
      - type: bind
        source: ./ui/fhir_mod.css
        target: /opt/fhir/ui/mod.css
        read_only: true
    environment:
      TZ: Europe/Berlin
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5003
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/dic3_fhir
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_dic3_fhir_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_dic3_fhir_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/dic3.crt
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/dic3.key
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD: 'password'
      DEV_DSF_FHIR_SERVER_UI_THEME: dev
      DEV_DSF_FHIR_DB_USER_GROUP: dic3_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: dic3_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: dic3_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: dic3_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://dic3/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_DIC_3
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE: [Task]
              - READ
              - UPDATE: [QuestionnaireResponse]
              - SEARCH
              - HISTORY
            practitioner-role:
              - http://dsf.dev/fhir/CodeSystem/practitioner-role|DSF_ADMIN
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/ca_chain.crt
      DEV_DSF_SERVER_AUTH_OIDC_AUTHORIZATION_CODE_FLOW: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BACK_CHANNEL_LOGOUT: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_REALM_BASE_URL: https://keycloak:8443/realms/dic3
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_ID: dic3-fhir
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_SECRET_FILE: /run/secrets/oidc_client_dic3_fhir.secret
    networks:
      dic3-fhir-frontend:
        ipv4_address: 172.20.0.19
      dic3-fhir-backend:
      internet:
    depends_on:
      - db
      - proxy
      - keycloak

  ttp-fhir:
    build: ../dsf-fhir/dsf-fhir-server-jetty/docker
    image: datasharingframework/fhir
    restart: "no"
    ports:
     - 127.0.0.1:5004:5004
    secrets:
      - db_liquibase.password
      - db_ttp_fhir_user.password
      - db_ttp_fhir_user_permanent_delete.password
      - root_ca.crt
      - ttp.crt
      - ttp.key
      - ttp.key.password
      - ca_chain.crt
      - oidc_client_ttp_fhir.secret
    volumes:
      - type: bind
        source: ./ttp/fhir/conf/bundle.xml
        target: /opt/fhir/conf/bundle.xml
        read_only: true
      - type: bind
        source: ./ttp/fhir/log
        target: /opt/fhir/log
      - type: bind
        source: ./ttp/ui/logo.svg
        target: /opt/fhir/ui/logo.svg
        read_only: true
      - type: bind
        source: ./ttp/ui/logo_dark.svg
        target: /opt/fhir/ui/logo_dark.svg
        read_only: true
      - type: bind
        source: ./ui/fhir_mod.css
        target: /opt/fhir/ui/mod.css
        read_only: true
    environment:
      TZ: Europe/Berlin
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5004
      DEV_DSF_FHIR_DB_URL: jdbc:postgresql://db/ttp_fhir
      DEV_DSF_FHIR_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_FHIR_DB_USER_PASSWORD_FILE: /run/secrets/db_ttp_fhir_user.password
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_PASSWORD_FILE: /run/secrets/db_ttp_fhir_user_permanent_delete.password
      DEV_DSF_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_FHIR_CLIENT_CERTIFICATE: /run/secrets/ttp.crt
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/ttp.key
      DEV_DSF_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/ttp.key.password
      DEV_DSF_FHIR_SERVER_UI_THEME: dev
      DEV_DSF_FHIR_DB_USER_GROUP: ttp_fhir_users
      DEV_DSF_FHIR_DB_USER_USERNAME: ttp_fhir_server_user
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_GROUP: ttp_fhir_permanent_delete_users
      DEV_DSF_FHIR_DB_USER_PERMANENT_DELETE_USERNAME: ttp_fhir_server_permanent_delete_user
      DEV_DSF_FHIR_SERVER_BASE_URL: https://ttp/fhir
      DEV_DSF_FHIR_SERVER_ORGANIZATION_IDENTIFIER_VALUE: Test_TTP
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT_DIC1: ${DIC1_THUMBPRINT}
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT_DIC2: ${DIC2_THUMBPRINT}
      DEV_DSF_FHIR_SERVER_ORGANIZATION_THUMBPRINT_DIC3: ${DIC3_THUMBPRINT}
      DEV_DSF_FHIR_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - CREATE: [Task]
              - READ
              - UPDATE: [QuestionnaireResponse]
              - SEARCH
              - HISTORY
            practitioner-role:
              - http://dsf.dev/fhir/CodeSystem/practitioner-role|DSF_ADMIN
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/ca_chain.crt
      DEV_DSF_SERVER_AUTH_OIDC_AUTHORIZATION_CODE_FLOW: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BACK_CHANNEL_LOGOUT: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_REALM_BASE_URL: https://keycloak:8443/realms/ttp 
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_ID: ttp-fhir
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_SECRET_FILE: /run/secrets/oidc_client_ttp_fhir.secret
    networks:
      ttp-fhir-frontend:
        ipv4_address: 172.20.0.27
      ttp-fhir-backend:
      internet:
    depends_on:
      - db
      - proxy
      - keycloak

  dic1-bpe:
    build: ../dsf-bpe/dsf-bpe-server-jetty/docker
    image: datasharingframework/bpe
    restart: "no"
    ports:
      - 127.0.0.1:5011:5011
    secrets:
      - db_liquibase.password
      - db_dic1_bpe_user.password
      - db_dic1_bpe_user_engine.password
      - root_ca.crt
      - dic1.crt
      - dic1.key
      - ca_chain.crt
      - oidc_client_dic1_bpe.secret
    volumes:
      - type: bind
        source: ./dic1/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./dic1/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./dic1/ui/logo.svg
        target: /opt/bpe/ui/logo.svg
        read_only: true
      - type: bind
        source: ./dic1/ui/logo_dark.svg
        target: /opt/bpe/ui/logo_dark.svg
        read_only: true
      - type: bind
        source: ./ui/bpe_mod.css
        target: /opt/bpe/ui/mod.css
        read_only: true
    environment:
      TZ: Europe/Berlin
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5011
      DEV_DSF_LOG_DATA_FILE_ENABLED: 'true'
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic1_bpe
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic1_bpe_user.password
      DEV_DSF_BPE_DB_USER_ENGINE_PASSWORD_FILE: /run/secrets/db_dic1_bpe_user_engine.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/dic1.crt
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/dic1.key
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD: 'password'
      DEV_DSF_BPE_DB_USER_GROUP: dic1_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic1_bpe_server_user
      DEV_DSF_BPE_DB_USER_ENGINE_GROUP: dic1_engine_users
      DEV_DSF_BPE_DB_USER_ENGINE_USERNAME: dic1_engine_server_user
      DEV_DSF_BPE_SERVER_BASE_URL: https://dic1/bpe
      DEV_DSF_BPE_SERVER_UI_THEME: dev
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic1/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED: >-
        dsfdev_updateAllowList|1.0
      DEV_DSF_BPE_MAIL_HOST: mailhog
      DEV_DSF_BPE_MAIL_PORT: 1025
      DEV_DSF_BPE_MAIL_FROMADDRESS: bpe@dic1
      DEV_DSF_BPE_MAIL_TOADDRESSES: bpe@dic1
      #DEV_DSF_BPE_MAIL_SENDTESTMAILONSTARTUP: 'false' # default no test mail on startup
      #DEV_DSF_BPE_PROCESS_EXCLUDED: # default no excluded processes
      # property dev.dsf.bpe.allow.list.organization should only be set for testing, do not configure property in production, potential security risk
      DEV_DSF_BPE_ALLOW_LIST_ORGANIZATION: Test_TTP
      DEV_DSF_BPE_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - ADMIN
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/ca_chain.crt
      DEV_DSF_SERVER_AUTH_OIDC_AUTHORIZATION_CODE_FLOW: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BACK_CHANNEL_LOGOUT: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_REALM_BASE_URL: https://keycloak:8443/realms/dic1
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_ID: dic1-bpe
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_SECRET_FILE: /run/secrets/oidc_client_dic1_bpe.secret
      DEV_DSF_PROXY_URL: http://forward-proxy:8080
      DEV_DSF_PROXY_USERNAME: proxy_user
      DEV_DSF_PROXY_PASSWORD: proxy_password
      DEV_DSF_PROXY_NOPROXY: keycloak
      DEV_DSF_BPE_FHIR_CLIENT_CONNECTIONS_CONFIG: |
        ttp-fhir-cert-auth:
          base-url: https://ttp/fhir
          test-connection-on-startup: yes
          cert-auth:
            certificate-file: /run/secrets/dic1.crt
            password: 'password'
            private-key-file: /run/secrets/dic1.key
        dic1-fhir-cert-auth:
          base-url: https://dic1/fhir
          test-connection-on-startup: yes
          cert-auth:
            certificate-file: /run/secrets/dic1.crt
            password: 'password'
            private-key-file: /run/secrets/dic1.key
        dic1-fhir-oidc-auth:
          base-url: https://dic1/fhir
          test-connection-on-startup: yes
          oidc-auth:
            base-url: https://keycloak:8443/realms/dic1
            test-connection-on-startup: yes
            client-id: dic1-bpe
            client-secret-file: /run/secrets/oidc_client_dic1_bpe.secret
            required-audience: account
      DEV_DSF_BPE_FHIR_CLIENT_CONNECTIONS_CONFIG_DEFAULT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
    networks:
      dic1-bpe-frontend:
        ipv4_address: 172.20.0.35
      dic1-bpe-backend:
      internet:
      forward-proxy:
    depends_on:
      - db
      - dic1-fhir
      - mailhog
      - keycloak
      - forward-proxy

  dic2-bpe:
    build: ../dsf-bpe/dsf-bpe-server-jetty/docker
    image: datasharingframework/bpe
    restart: "no"
    ports:
      - 127.0.0.1:5012:5012
    secrets:
      - db_liquibase.password
      - db_dic2_bpe_user.password
      - db_dic2_bpe_user_engine.password
      - root_ca.crt
      - dic2.crt
      - dic2.key
      - ca_chain.crt
      - oidc_client_dic2_bpe.secret
    volumes:
      - type: bind
        source: ./dic2/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./dic2/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./dic2/ui/logo.svg
        target: /opt/bpe/ui/logo.svg
        read_only: true
      - type: bind
        source: ./dic2/ui/logo_dark.svg
        target: /opt/bpe/ui/logo_dark.svg
        read_only: true
      - type: bind
        source: ./ui/bpe_mod.css
        target: /opt/bpe/ui/mod.css
        read_only: true
    environment:
      TZ: Europe/Berlin
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5012
      DEV_DSF_LOG_DATA_FILE_ENABLED: 'true'
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic2_bpe
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic2_bpe_user.password
      DEV_DSF_BPE_DB_USER_ENGINE_PASSWORD_FILE: /run/secrets/db_dic2_bpe_user_engine.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/dic2.crt
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/dic2.key
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD: 'password'
      DEV_DSF_BPE_DB_USER_GROUP: dic2_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic2_bpe_server_user
      DEV_DSF_BPE_DB_USER_ENGINE_GROUP: dic2_engine_users
      DEV_DSF_BPE_DB_USER_ENGINE_USERNAME: dic2_engine_server_user
      DEV_DSF_BPE_SERVER_BASE_URL: https://dic2/bpe
      DEV_DSF_BPE_SERVER_UI_THEME: dev
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic2/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED: >-
        dsfdev_updateAllowList|1.0
      DEV_DSF_BPE_MAIL_HOST: mailhog
      DEV_DSF_BPE_MAIL_PORT: 1025
      DEV_DSF_BPE_MAIL_FROMADDRESS: bpe@dic2
      DEV_DSF_BPE_MAIL_TOADDRESSES: bpe@dic2
      #DEV_DSF_BPE_MAIL_SENDTESTMAILONSTARTUP: 'false' # default no test mail on startup
      #DEV_DSF_BPE_PROCESS_EXCLUDED: # default no excluded processes
      # property dev.dsf.bpe.allow.list.organization should only be set for testing, do not configure property in production, potential security risk
      DEV_DSF_BPE_ALLOW_LIST_ORGANIZATION: Test_TTP
      DEV_DSF_BPE_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - ADMIN
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/ca_chain.crt
      DEV_DSF_SERVER_AUTH_OIDC_AUTHORIZATION_CODE_FLOW: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BACK_CHANNEL_LOGOUT: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_REALM_BASE_URL: https://keycloak:8443/realms/dic2
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_ID: dic2-bpe
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_SECRET_FILE: /run/secrets/oidc_client_dic2_bpe.secret
    networks:
      dic2-bpe-frontend:
        ipv4_address: 172.20.0.43
      dic2-bpe-backend:
      internet:
    depends_on:
      - db
      - dic2-fhir
      - mailhog
      - keycloak

  dic3-bpe:
    build: ../dsf-bpe/dsf-bpe-server-jetty/docker
    image: datasharingframework/bpe
    restart: "no"
    ports:
      - 127.0.0.1:5014:5014
    secrets:
      - db_liquibase.password
      - db_dic3_bpe_user.password
      - db_dic3_bpe_user_engine.password
      - root_ca.crt
      - dic3.crt
      - dic3.key
      - ca_chain.crt
      - oidc_client_dic3_bpe.secret
    volumes:
      - type: bind
        source: ./dic3/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./dic3/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./dic3/ui/logo.svg
        target: /opt/bpe/ui/logo.svg
        read_only: true
      - type: bind
        source: ./dic3/ui/logo_dark.svg
        target: /opt/bpe/ui/logo_dark.svg
        read_only: true
      - type: bind
        source: ./ui/bpe_mod.css
        target: /opt/bpe/ui/mod.css
        read_only: true
    environment:
      TZ: Europe/Berlin
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5014
      DEV_DSF_LOG_DATA_FILE_ENABLED: 'true'
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/dic3_bpe
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_dic3_bpe_user.password
      DEV_DSF_BPE_DB_USER_ENGINE_PASSWORD_FILE: /run/secrets/db_dic3_bpe_user_engine.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/dic3.crt
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/dic3.key
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD: 'password'
      DEV_DSF_BPE_DB_USER_GROUP: dic3_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: dic3_bpe_server_user
      DEV_DSF_BPE_DB_USER_ENGINE_GROUP: dic3_engine_users
      DEV_DSF_BPE_DB_USER_ENGINE_USERNAME: dic3_engine_server_user
      DEV_DSF_BPE_SERVER_BASE_URL: https://dic3/bpe
      DEV_DSF_BPE_SERVER_UI_THEME: dev
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://dic3/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED: >-
        dsfdev_updateAllowList|1.0
      DEV_DSF_BPE_MAIL_HOST: mailhog
      DEV_DSF_BPE_MAIL_PORT: 1025
      DEV_DSF_BPE_MAIL_FROMADDRESS: bpe@dic3
      DEV_DSF_BPE_MAIL_TOADDRESSES: bpe@dic3
      #DEV_DSF_BPE_MAIL_SENDTESTMAILONSTARTUP: 'false' # default no test mail on startup
      #DEV_DSF_BPE_PROCESS_EXCLUDED: # default no excluded processes
      # property dev.dsf.bpe.allow.list.organization should only be set for testing, do not configure property in production, potential security risk
      DEV_DSF_BPE_ALLOW_LIST_ORGANIZATION: Test_TTP
      DEV_DSF_BPE_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - ADMIN
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/ca_chain.crt
      DEV_DSF_SERVER_AUTH_OIDC_AUTHORIZATION_CODE_FLOW: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BACK_CHANNEL_LOGOUT: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_REALM_BASE_URL: https://keycloak:8443/realms/dic3
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_ID: dic3-bpe
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_SECRET_FILE: /run/secrets/oidc_client_dic3_bpe.secret
    networks:
      dic3-bpe-frontend:
        ipv4_address: 172.20.0.51
      dic3-bpe-backend:
      internet:
    depends_on:
      - db
      - dic3-fhir
      - mailhog
      - keycloak

  ttp-bpe:
    build: ../dsf-bpe/dsf-bpe-server-jetty/docker
    image: datasharingframework/bpe
    restart: "no"
    ports:
      - 127.0.0.1:5013:5013
    secrets:
      - db_liquibase.password
      - db_ttp_bpe_user.password
      - db_ttp_bpe_user_engine.password
      - root_ca.crt
      - ttp.crt
      - ttp.key
      - ttp.key.password
      - ca_chain.crt
      - oidc_client_ttp_bpe.secret
    volumes:
      - type: bind
        source: ./ttp/bpe/process
        target: /opt/bpe/process
        read_only: true
      - type: bind
        source: ./ttp/bpe/log
        target: /opt/bpe/log
      - type: bind
        source: ./ttp/ui/logo.svg
        target: /opt/bpe/ui/logo.svg
        read_only: true
      - type: bind
        source: ./ttp/ui/logo_dark.svg
        target: /opt/bpe/ui/logo_dark.svg
        read_only: true
      - type: bind
        source: ./ui/bpe_mod.css
        target: /opt/bpe/ui/mod.css
    environment:
      TZ: Europe/Berlin
      EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5013
      DEV_DSF_LOG_DATA_FILE_ENABLED: 'true'
      DEV_DSF_BPE_DB_URL: jdbc:postgresql://db/ttp_bpe
      DEV_DSF_BPE_DB_LIQUIBASE_PASSWORD_FILE: /run/secrets/db_liquibase.password
      DEV_DSF_BPE_DB_USER_PASSWORD_FILE: /run/secrets/db_ttp_bpe_user.password
      DEV_DSF_BPE_DB_USER_ENGINE_PASSWORD_FILE: /run/secrets/db_ttp_bpe_user_engine.password
      DEV_DSF_BPE_FHIR_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE: /run/secrets/ttp.crt
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY: /run/secrets/ttp.key
      DEV_DSF_BPE_FHIR_CLIENT_CERTIFICATE_PRIVATE_KEY_PASSWORD_FILE: /run/secrets/ttp.key.password
      DEV_DSF_BPE_DB_USER_GROUP: ttp_bpe_users
      DEV_DSF_BPE_DB_USER_USERNAME: ttp_bpe_server_user
      DEV_DSF_BPE_DB_USER_ENGINE_GROUP: TTP_ENGINE_USERS
      DEV_DSF_BPE_DB_USER_ENGINE_USERNAME: ttp_engine_server_user
      DEV_DSF_BPE_SERVER_BASE_URL: https://ttp/bpe
      DEV_DSF_BPE_SERVER_UI_THEME: dev
      DEV_DSF_BPE_FHIR_SERVER_BASE_URL: https://ttp/fhir
      DEV_DSF_BPE_PROCESS_EXCLUDED: >-
        dsfdev_downloadAllowList|1.0
      DEV_DSF_BPE_MAIL_HOST: mailhog
      DEV_DSF_BPE_MAIL_PORT: 1025
      DEV_DSF_BPE_MAIL_FROMADDRESS: bpe@ttp
      DEV_DSF_BPE_MAIL_TOADDRESSES: bpe@ttp
      DEV_DSF_BPE_MAIL_SENDTESTMAILONSTARTUP: 'true'
      DEV_DSF_BPE_MAIL_SENDMAILONERRORLOGEVENT: 'true'
      #DEV_DSF_BPE_PROCESS_EXCLUDED: # default no excluded processes
      # property dev.dsf.bpe.allow.list.organization should only be set for testing, do not configure property in production, potential security risk
      DEV_DSF_BPE_ALLOW_LIST_ORGANIZATION: Test_TTP
      DEV_DSF_BPE_SERVER_ROLECONFIG: |
        - webbrowser_test_user:
            thumbprint: ${WEBBROWSER_TEST_USER_THUMBPRINT}
            token-role: admin
            dsf-role:
              - ADMIN
      DEV_DSF_SERVER_AUTH_TRUST_CLIENT_CERTIFICATE_CAS: /run/secrets/ca_chain.crt
      DEV_DSF_SERVER_AUTH_OIDC_AUTHORIZATION_CODE_FLOW: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BACK_CHANNEL_LOGOUT: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_BEARER_TOKEN: 'true'
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_REALM_BASE_URL: https://keycloak:8443/realms/ttp 
      DEV_DSF_SERVER_AUTH_OIDC_PROVIDER_CLIENT_TRUST_SERVER_CERTIFICATE_CAS: /run/secrets/root_ca.crt
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_ID: ttp-bpe
      DEV_DSF_SERVER_AUTH_OIDC_CLIENT_SECRET_FILE: /run/secrets/oidc_client_ttp_bpe.secret
    networks:
      ttp-bpe-frontend:
        ipv4_address: 172.20.0.59
      ttp-bpe-backend:
      internet:
    depends_on:
      - db
      - ttp-fhir
      - mailhog
      - keycloak

  mailhog:
    image: mailhog/mailhog
    restart: "no"
    ports:
      - 127.0.0.1:8025:8025 # web ui
    networks:
      internet:

secrets:
  localhost.chain.crt:
    file: ./secrets/localhost.chain.crt
  localhost.key.plain:
    file: ./secrets/localhost.key.plain

  keycloak.chain.crt:
    file: ./secrets/keycloak.chain.crt
  keycloak.key.plain:
    file: ./secrets/keycloak.key.plain
  keycloak_trust_store.jks:
    file: ./secrets/keycloak_trust_store.jks

  dic1.crt:
    file: ./secrets/dic1.crt
  dic1.key:
    file: ./secrets/dic1.key
  dic2.crt:
    file: ./secrets/dic2.crt
  dic2.key:
    file: ./secrets/dic2.key
  dic3.crt:
    file: ./secrets/dic3.crt
  dic3.key:
    file: ./secrets/dic3.key
  ttp.crt:
    file: ./secrets/ttp.crt
  ttp.key:
    file: ./secrets/ttp.key
  ttp.key.password:
    file: ./secrets/ttp.key.password

  root_ca.crt:
    file: ./secrets/root_ca.crt
  issuing_ca.crt:
    file: ./secrets/issuing_ca.crt
  ca_chain.crt:
    file: ./secrets/ca_chain.crt

  db_liquibase.password:
    file: ./secrets/db_liquibase.password
    
  db_dic1_bpe_user.password:
    file: ./secrets/db_dic1_bpe_user.password
  db_dic1_bpe_user_engine.password:
    file: ./secrets/db_dic1_bpe_user_engine.password
  db_dic1_fhir_user.password:
    file: ./secrets/db_dic1_fhir_user.password
  db_dic1_fhir_user_permanent_delete.password:
    file: ./secrets/db_dic1_fhir_user_permanent_delete.password
    
  db_dic2_bpe_user.password:
    file: ./secrets/db_dic2_bpe_user.password
  db_dic2_bpe_user_engine.password:
    file: ./secrets/db_dic2_bpe_user_engine.password
  db_dic2_fhir_user.password:
    file: ./secrets/db_dic2_fhir_user.password
  db_dic2_fhir_user_permanent_delete.password:
    file: ./secrets/db_dic2_fhir_user_permanent_delete.password
    
  db_dic3_bpe_user.password:
    file: ./secrets/db_dic3_bpe_user.password
  db_dic3_bpe_user_engine.password:
    file: ./secrets/db_dic3_bpe_user_engine.password
  db_dic3_fhir_user.password:
    file: ./secrets/db_dic3_fhir_user.password
  db_dic3_fhir_user_permanent_delete.password:
    file: ./secrets/db_dic3_fhir_user_permanent_delete.password
    
  db_ttp_bpe_user.password:
    file: ./secrets/db_ttp_bpe_user.password
  db_ttp_bpe_user_engine.password:
    file: ./secrets/db_ttp_bpe_user_engine.password
  db_ttp_fhir_user.password:
    file: ./secrets/db_ttp_fhir_user.password
  db_ttp_fhir_user_permanent_delete.password:
    file: ./secrets/db_ttp_fhir_user_permanent_delete.password

  oidc_client_dic1_fhir.secret:
    file: ./secrets/oidc_client_dic1_fhir.secret
  oidc_client_dic2_fhir.secret:
    file: ./secrets/oidc_client_dic2_fhir.secret
  oidc_client_dic3_fhir.secret:
    file: ./secrets/oidc_client_dic3_fhir.secret
  oidc_client_ttp_fhir.secret:
    file: ./secrets/oidc_client_ttp_fhir.secret

  oidc_client_dic1_bpe.secret:
    file: ./secrets/oidc_client_dic1_bpe.secret
  oidc_client_dic2_bpe.secret:
    file: ./secrets/oidc_client_dic2_bpe.secret
  oidc_client_dic3_bpe.secret:
    file: ./secrets/oidc_client_dic3_bpe.secret
  oidc_client_ttp_bpe.secret:
    file: ./secrets/oidc_client_ttp_bpe.secret
  
networks:
  dic1-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.20.0.0/29
  dic1-fhir-backend:
  dic2-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.20.0.8/29
  dic2-fhir-backend:
  dic3-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.20.0.16/29
  dic3-fhir-backend:
  ttp-fhir-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.20.0.24/29
  ttp-fhir-backend:
  dic1-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.20.0.32/29
  dic1-bpe-backend:
  dic2-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.20.0.40/29
  dic2-bpe-backend:
  dic3-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.20.0.48/29
  dic3-bpe-backend:
  ttp-bpe-frontend:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.20.0.56/29
  ttp-bpe-backend:
  internet:
  forward-proxy:

volumes:
  postgresql:
    name: postgresql